<% title @user.name %>

<%= content_for :page_meta do %>
  <%= render "users/meta" %>
<% end %>

<% cache "main-user-profile-header-area-#{@user.id}-#{@user.profile_updated_at}", expires_in: 10.days do %>
  <style>
    .widget header {
      color: <%= HexComparer.new([user_colors(@user)[:bg], user_colors(@user)[:text]]).brightness(0.88) %>;
    }

    <% if user_colors(@user)[:bg].downcase.start_with?("#fff") %>
    .user-profile-follow-button {
      border: 1px solid <%= user_colors(@user)[:text] %> !important;
    }

    <% end %>
  </style>
  <div class="user-profile-header" style="<%= user_colors_style(@user) %>" itemscope itemtype="http://schema.org/Person" itemprop="mainEntityOfPage">
    <meta itemprop="url" content="https://dev.to/<%= @user.username %>">
    <div class="user-profile-header-container">
      <div class="profile-pic-wrapper">
        <img class="profile-pic" src="<%= ProfileImage.new(@user).get(320) %>" itemprop="image" alt="<%= @user.username %> profile" style="border-color:<%= user_colors(@user)[:bg] %>;background:<%= user_colors(@user)[:bg] %>" />
      </div>
      <div class="profile-details">
        <h1 style="color:<%= HexComparer.new([user_colors(@user)[:bg], user_colors(@user)[:text]]).brightness(0.78) %>">
          <span itemprop="name"><%= @user.name %></span>
          <span class="user-profile-follow-button-wrapper">
            <button id="user-follow-butt" class="cta follow-action-button user-profile-follow-button" style="color:<%= user_colors(@user)[:text] %>;background-color:<%= user_colors(@user)[:bg] %>" data-info='{"id":<%= @user.id %>,"className":"<%= @user.class.name %>"}'>&nbsp;</button>
          </span>
          <span class="user-profile-chat-button-wrapper">
            <a href="/connect/@<%= @user.username %>" id="user-connect-redirect" style="display:none">
              <button class="chat-action-button user-profile-chat-button" id="modal-opener" style="color:<%= user_colors(@user)[:text] %>;background-color:<%= user_colors(@user)[:bg] %>; display:none; ">CHAT</button>
            </a>
          </span>

        </h1>
        <p class="profile-description" itemprop="description">
          <%= @user.summary.presence || ["404 bio not found"].sample %>
        </p>
        <style>
          .profile-details .social .icon-img path {
            fill: <%= HexComparer.new([user_colors(@user)[:bg], user_colors(@user)[:text]]).brightness(0.78) %> !important;
          }
        </style>
        <p class="social">
          <% if @user.twitter_username? %>
            <a href="https://twitter.com/<%= @user.twitter_username %>" target="_blank" rel="noopener me">
              <%= inline_svg("twitter-logo.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.github_username? %>
            <a href="https://github.com/<%= @user.github_username %>" target="_blank" rel="noopener me">
              <%= inline_svg("github-logo.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.mastodon_url? %>
            <a href="<%= @user.mastodon_url %>" target="_blank" rel="noopener me">
              <%= inline_svg("mastodon-logo.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.facebook_url? %>
            <a href="<%= @user.facebook_url %>" target="_blank" rel="noopener me">
              <%= inline_svg("facebook-logo.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.linkedin_url? %>
            <a href="<%= @user.linkedin_url %>" target="_blank" rel="noopener me">
              <%= inline_svg("linkedin_icon.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.behance_url? %>
            <a href="<%= @user.behance_url %>" target="_blank" rel="noopener me">
              <%= inline_svg("behance_icon.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.stackoverflow_url? %>
            <a href="<%= @user.stackoverflow_url %>" target="_blank" rel="noopener me">
              <%= inline_svg("stackoverflow-logo.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.dribbble_url? %>
            <a href="<%= @user.dribbble_url %>" target="_blank" rel="noopener me">
              <%= inline_svg("dribbble_icon.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.medium_url? %>
            <a href="<%= @user.medium_url %>" target="_blank" rel="noopener nofollow me">
              <%= inline_svg("medium_icon.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.gitlab_url? %>
            <a href="<%= @user.gitlab_url %>" target="_blank" rel="noopener nofollow me">
              <%= inline_svg("gitlab.svg", class: "icon-img") %>
            </a>
          <% end %>
          <% if @user.website_url? %>
            <a href="<%= @user.website_url %>" target="_blank" rel="noopener nofollow me">
              <%= inline_svg("external-link-logo.svg", class: "icon-img") %>
            </a>
          <% end %>
        </p>
      </div>
    </div>
    <div class="modal" style="display: none">
      <div class="overlay"></div>
      <div class="modal-content " id="new-message-modal">
        <button title="Close" class="close-modal">X</button>
        <form id="new-message-form" class="message-form" data-info='{"id":<%= @user.id %>,"className":"<%= @user.class.name %>","username":"<%= @user.username %>", "showChat":"<%= @user.inbox_type %>"}'>
          <textarea id="new-message" rows="4" cols="70" placeholder="Enter your message here..."></textarea>
          <button type="submit" value="Submit" class="submit-message">SEND</button>
        </form>
      </div>
    </div>
    <%= render "articles/user_metadata", context: "profile" %>
  </div>
<% end %>

<div class="home sub-home" id="index-container"
     data-params="<%= params.to_json(only: %i[tag username q]) %>" data-which="<%= @list_of %>"
     data-algolia-tag="<%= "user_#{@user.id}" %>"
     data-feed="<%= params[:timeframe] || "base-feed" %>"
     data-articles-since="0">
  <div class="nav-links">
    <a class="nav-link <% if @tab == 'home' %>selected<% end %>" href="/<%= @user.username %>">
      HOME
    </a>
    <a class="nav-link <% if @tab == 'about' %>selected<% end %>" href="/<%= @user.username %>/profile/about">
      ABOUT
    </a>
    <% if @stories.any? %>
      <a class="nav-link <% if @tab == 'articles' %>selected<% end %>" href="/<%= @user.username %>/profile/articles">
        ARTICLES
      </a>
    <% end %>
    <% if @comments.any? %>
    <a class="nav-link <% if @tab == 'comment-list' %>selected<% end %>" href="/<%= @user.username %>/profile/comment-list">
      COMMENTS
    </a>
    <% end %>
  </div>
  <% if @tab == 'articles' %>
    <div class="side-bar">
      <div class="user-sidebar">
      <% cache "user-profile-sidebar-stats-#{@user.id}-#{@user.last_article_at}-#{@user.last_comment_at}-#{@user.last_followed_at}", expires_in: 10.days do %>
        <div class="sidebar-data">
          <div>
            <%= pluralize @user.articles.where(published: true).size, "Post" %> Published
          </div>
          <div>
            <%= pluralize @user.comments.where(deleted: false).size, "Comment" %> Written
          </div>
          <div>
            <%= pluralize @user.decorate.cached_followed_tags.size, "Tag" %> Followed
          </div>
        </div>
      <% end %>
      </div>
    </div>
    <div class="articles-list" id="articles-list">
      <div class="substories" id="substories">
        <%= render "users/main_feed" %>
      </div>
      <div class="loading-articles" id="loading-articles">
        loading...
      </div>
    </div>
  <% end %>
  <% if @tab == 'comment-list' %>
    <%= render "users/comments_section" %>
  <% end %>
  <% if @tab == 'about' %>
    <% cache "user-profile-sidebar-profile-details-#{@user.id}-#{@user.profile_updated_at}", expires_in: 10.days do %>
      <div class="about-widgets">
        <div class="widget">
          <header>
            <h4>About</h4>
          </header>
          <div class="widget-body">
            <%= @user.summary.presence ? @user.summary : ["404 bio not found"].sample %>
          </div>
        </div>
        <div class="row">
          <% if @user.mostly_work_with.present? %>
            <div class="widget">
              <header>
                <h4>skills/languages</h4>
              </header>
              <div class="widget-body">
                <%= sanitized_sidebar @user.mostly_work_with %>
              </div>
            </div>
          <% end %>
          <% if @user.currently_learning.present? %>
            <div class="widget">
              <header>
                <h4>learning/trying</h4>
              </header>
              <div class="widget-body">
                <%= sanitized_sidebar @user.currently_learning %>
              </div>
            </div>
          <% end %>
          <% if @user.currently_hacking_on.present? %>
            <div class="widget">
              <header>
                <h4>projects and hacks</h4>
              </header>
              <div class="widget-body">
                <%= sanitized_sidebar @user.currently_hacking_on %>
              </div>
            </div>
          <% end %>
          <% if @user.available_for.present? %>
            <div class="widget">
              <header>
                <h4>available for</h4>
              </header>
              <div class="widget-body">
                <%= sanitized_sidebar @user.available_for %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
<%= render "stories/narrow_nav_menu" %>
<%= render "stories/stories_list_script" %>
